
HUploader=HControl.extend({componentName:'uploader',uploadState:false,uploadKey:false,uploadStateLabels:{'0':"Select file...",'1':"Uploading...",'2':"Processing data...",'3':"Upload Complete",'4':"Preparing upload",'-1':"Error: Invalid request",'-2':"Error: Invalid upload key",'-3':"Error: Invalid data format",'-4':"Error: File too big",'-6':"Error: Post-processing failed"},markupElemNames:['form','file','iframe','upload_progress','progress_label','progress_indicator','button','button_label','value','ack_button'],setUploadState:function(_L,_4P){if(_L!==this.uploadState){this.uploadState=_L;var _3c=_L.toString();if(this.uploadStateLabels[_3c]!==undefined){ELEM.get(this.markupElemIds.value).value=this.valueObj.id;var _J=this.uploadStateLabels[_3c];if(_L==0){ELEM.setStyle(this.markupElemIds.upload_progress,'visibility','hidden');ELEM.setStyle(this.markupElemIds.progress_indicator,'visibility','hidden');ELEM.setStyle(this.markupElemIds.ack_button,'visibility','hidden');ELEM.setHTML(this.markupElemIds.button_label,_J);ELEM.setStyle(this.markupElemIds.button,'visibility','inherit');ELEM.setStyle(this.markupElemIds.form,'visibility','inherit');ELEM.setAttr(this.markupElemIds.form,'action','/U/'+_4P,true);ELEM.get(this.markupElemIds.file).value='';this.uploadKey=_4P;}
else if(_L==1||_L==2||_L==3||_L==4){ELEM.setStyle(this.markupElemIds.upload_progress,'visibility','inherit');if(_L==1||_L==2||_L==4){ELEM.setStyle(this.markupElemIds.progress_indicator,'visibility','inherit');ELEM.setStyle(this.markupElemIds.ack_button,'visibility','hidden');}
else{ELEM.setStyle(this.markupElemIds.progress_indicator,'visibility','hidden');ELEM.setStyle(this.markupElemIds.ack_button,'visibility','inherit');}
ELEM.setHTML(this.markupElemIds.progress_label,_J);ELEM.setStyle(this.markupElemIds.button,'visibility','hidden');ELEM.setStyle(this.markupElemIds.form,'visibility','hidden');if(_L==1){ELEM.get(this.markupElemIds.form).submit();}}
else if(_L<0){ELEM.setStyle(this.markupElemIds.progress_indicator,'visibility','hidden');ELEM.setStyle(this.markupElemIds.ack_button,'visibility','inherit');ELEM.setHTML(this.markupElemIds.progress_label,'<span style="color:red;">'+_J+'</span>');ELEM.setStyle(this.markupElemIds.button,'visibility','hidden');ELEM.setStyle(this.markupElemIds.form,'visibility','hidden');}}}},refreshValue:function(){if(!(typeof this.value=='string')){return;}
if(this.value.indexOf(':::')<1){return;}
var _3b=this.value.split(':::');if(_3b.length!=2){return;}
var _L=parseInt(_3b[0],10),_4P=_3b[1];this.setUploadState(_L,_4P);},upload:function(){this.setValue('1:::'+this.uploadKey);},getNewUploadKey:function(){this.setValue('4:::'+this.uploadKey);},click:function(){if((this.uploadState==3)||(this.uploadState<0)){this.getNewUploadKey();}}});